{% extends 'list.html' %}
{% load static %}
{% block head_list %}

{% endblock %}

{% block columns %}
<tr>
    <th>Nombre</th>
    <th>Marca</th>          
    <th>Modelo</th>          
    <th>Placa</th>
    <th>Imágen</th>
    <th>Tipo</th>
    <th>Año</th> 
    <th>Opciones</th>
</tr>
{% endblock %}

{% block javascript %}
<script>

var miTabla;  
let modal_title;
function getData(){
    $(function () {
    miTabla = $('#data').DataTable({
        responsive: true,
        autoWidth: false,
        destroy: true,
        deferRender: true, /*  Para cuando hay más de 50.000 registros*/
        ajax: {
            url: window.location.pathname,
            type: 'POST',
            data: {
                'action': 'searchdata'
            },
            dataSrc: "" /*Para identificar todos los datos con un nombre de variable*/
        },
        columns: [
            {"data": "nombre"},
            {"data": "marca.nombre"},
            {"data": "modelo"},
            {"data": "placa"},
            {"data": "imagen"},
            {"data": "tipo.nombre"},
            {"data": "anio"},
            {"data": "anio"},/*Esta se repite para poder tener la columna de los botones*/
        ],          
            columnDefs: [
            {
                targets: [-4],
                class: 'text-center',
                orderable: false,
                render: function (data, type, row) {
                    return '<img src="'+data+'" class="img-fluid d-block mx-auto" style="width: 30px; height: 25px;">';
                }
            },
            {
                targets: [-1],
                class: 'text-center',
                orderable: false,/*Esta columna de botones no es necesario que se ordene*/
                render: function (data, type, row) {
                var buttons = '<a href="/app/update_vehiculo/'+ row.id+'/" rel="edit" class="btn btn-warning btn-sm"><i class="fas fa-edit"></i></a> ';
                buttons += '<a href="#" rel="delete" type="button" class="btn btn-danger btn-sm"><i class="fas fa-trash-alt"></i></a>';
                return buttons;
                }
            },
            ],
            initComplete: function (settings, json) {
            toastr.success('Tabla cargada completamente', 'Excelente!',{
                "progressBar": true,
                "positionClass": "toast-bottom-right"
            });
        }
    });
    });
}
$(function () {
    getData();
    modal_title = $('.modal-title');
    $('#data tbody')    
    .on('click', 'a[rel="delete"]', function () {
        var tr = miTabla.cell($(this).closest('td, li')).index();
        var data = miTabla.row(tr.row).data();
        var parameters = new FormData();
        parameters.append('action', 'delete');
        parameters.append('id', data.id);    
        submit_with_ajax(window.location.pathname, 'Notificación', '¿Estas seguro de realizar eliminar el siguiente registro?', parameters, function () {
            miTabla.ajax.reload();
        });
    }); 
});
</script>
{% endblock javascript %}